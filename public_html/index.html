<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/style.css"/>
    </head>
    <body id="all">
    </body>
    <script>
        tauler = new Array(30);

        tauler[29] = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        tauler[28] = [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0];
        tauler[27] = [0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0];
        tauler[26] = [0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0];
        tauler[25] = [0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0];
        tauler[24] = [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0];
        tauler[23] = [0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0];
        tauler[22] = [0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0];
        tauler[21] = [0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0];
        tauler[20] = [0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0];
        tauler[19] = [0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0];
        tauler[18] = [0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0];
        tauler[17] = [0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0];
        tauler[16] = [0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0];
        tauler[15] = [0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0];
        tauler[14] = [0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0];
        tauler[13] = [0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0];
        tauler[12] = [0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0];
        tauler[11] = [0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0];
        tauler[10] = [0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0];
        tauler[9] = [0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0];
        tauler[8] = [0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0];
        tauler[7] = [0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0];
        tauler[6] = [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0];
        tauler[5] = [0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0];
        tauler[4] = [0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0];
        tauler[3] = [0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0];
        tauler[2] = [0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0];
        tauler[1] = [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0];
        tauler[0] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        //Llegenda
        document.write("<span style='background-color: #93b9ff;'>x = j</span><br>");
        document.write("<span style='background-color: #ff7644;'>y = i</span>");
        document.write("<br>");
        //----
        //Inicialitza variable jugador + 3 fantasmes
        inicialitzarCaracters();
        //Assignem una direcció inicial a cada variable
        assignarDireccioInicial(jugador);
        assignarDireccioInicial(fantasma1);
        assignarDireccioInicial(fantasma2);
        assignarDireccioInicial(fantasma3);
        //Comprovem direccions(1-Amunt, 2-Dreta, 3-Abaix, 4-Esquerra)
        document.write("Direccions: (1-Amunt, 2-Dreta, 3-Abaix, 4-Esquerra)<br>");
        document.write("Direccio Jugador: " + jugador["direccio"]);
        document.write("<br>Direccio fantasma1: " + fantasma1["direccio"]);
        document.write("<br>Direccio fantasma2: " + fantasma2["direccio"]);
        document.write("<br>Direccio fantasma3: " + fantasma3["direccio"]);

        //Mostra el tauler
        mostrarTauler();
        //mostra el tauler girat cap a l'esquerra perque comença a mostrar a la posicio 0,0 (part inferior esquerra)

        function assignarDireccioInicial(variable) {
            //Creem 4 variables per comptar quant espai lliure n'hi ha respecte al jugador o fantasma
            var comptarAmunt = 0;
            var comptarAbaix = 0;
            var comptarEsquerra = 0;
            var comptarDreta = 0;

            if (tauler[variable["y"] + 1][variable["x"]] === 1) {//Si es pot anar amunt al menys un cop
                var i = 1;
                while ((tauler[variable["y"] + i][variable["x"]] !== 0) && (tauler[variable["y"] + i][variable["x"]] !== "F")) {
                    //aquest while es el mateix per els 4 ifs (4 direccions), el que nomes canvia es la posicio de la x o y
                    //el while va comptant quant espai n'hi ha en cada direcció, te en compte també si hi ha un fantasma deixa de comptar
                    //en el cas del jugador no fa falta
                    comptarAmunt = i; //cada vegada que fa el bucle actualitzem el comptador
                    i++;
                }

            }
            if (tauler[variable["y"] - 1][variable["x"]] === 1) {//Si al menys es pot anar cap abaix un cop
                var i = 1;
                while ((tauler[variable["y"] - i][variable["x"]] !== 0) && (tauler[variable["y"] - i][variable["x"]] !== "F")) {
                    comptarAbaix = i;
                    i++;
                }
            }
            if (tauler[variable["y"]][variable["x"] - 1] === 1) { //Si al menys es pot anar cap a l'esquerra un cop
                var i = 1;
                while ((tauler[variable["y"]][variable["x"] - i] !== 0) && (tauler[variable["y"]][variable["x"] - i] !== "F")) {
                    comptarEsquerra = i;
                    i++;
                }
            }

            if (tauler[variable["y"]][variable["x"] + 1] === 1) { //Si al menys es pot anar cap a la dreta un cop
                var i = 1;
                while ((tauler[variable["y"]][variable["x"] + i] !== 0) && (tauler[variable["y"]][variable["x"] + i] !== "F")) {
                    comptarDreta = i;
                    i++;
                }
            }

            //Creem un array de 5 posicions (no usarem la 0), 
            //en el cual la posicio 1 sera amunt, el 2 dreta, 3 esquerra,...
            //esta en aquest ordre perque sigui facil identificar, (va com les agulles del rellotje, encara que realment les posicions haurien de ser 0,3,6,9... pero com ho volem fer facil i es una cosa que qui programa ho sap ho deixo així)

            var comptarTotes = new Array(5);
            comptarTotes[1] = comptarAmunt;
            comptarTotes[2] = comptarDreta;
            comptarTotes[3] = comptarAbaix;
            comptarTotes[4] = comptarEsquerra;
            var max = -1; //fem una variable per saber quin es el maxim, iniciem a -1 perque qualsevol valor sigui el maxim per minim que sigui
            var ultimMaxim = 0; //ultim maxim emmagatzemara la ultima i de la direccio amb mes espais lliures
            //per aixi saber quina es la direccio mes correcta per començar

            for (var i = 1; i < comptarTotes.length; i++) {
                if (comptarTotes[i] >= max) { //en el cas de que sigui un valor igual al maxim, el maxim sera l'ultim igual (es podria allargar la funcio amb un random per escollir quin dels dos, pero ho veig be aixi)
                    max = comptarTotes[i];
                    ultimMaxim = i;
                }
            }

            variable["direccio"] = ultimMaxim; //finalment li diem que la direccio del fantasma o jugador es la de l'ultim Maxim
        }

        function inicialitzarCaracters() {
            jugador = new Array();
            jugador["x"] = 0; //on guardem la X
            jugador["y"] = 0; //on guardem la Y
            jugador["direccio"] = 0; //on guardem la seva direcció 
            jugador["direccioUsuari"] = 0; //on guardem la direccio que es prem pel teclat

            fantasma1 = new Array();
            fantasma1["x"] = 0;
            fantasma1["y"] = 0;
            fantasma1["direccio"] = 0;

            fantasma2 = new Array();
            fantasma2["x"] = 0;
            fantasma2["y"] = 0;
            fantasma2["direccio"] = 0;

            fantasma3 = new Array();
            fantasma3["x"] = 0;
            fantasma3["y"] = 0;
            fantasma3["direccio"] = 0;


            /*Això és inici del punt 2 (funciona)*/
            posicionaAlTauler(jugador);
            posicionaAlTauler(fantasma1);
            posicionaAlTauler(fantasma2);
            posicionaAlTauler(fantasma3);

        }

        function posicionaAlTauler(variable) {
            var noEstaOcupat = true; //variable que fara d'interruptor en el cas de que on volem posicionar un jugador o fantasma ja estigui ocupat
            do {

                variable["x"] = generarNumeroAleatori(0, 29); //generem 2 numeros aleatoris per la x 
                variable["y"] = generarNumeroAleatori(0, 29); //generem 2 numeros aleatoris per la y

                if (tauler[variable["y"]][variable["x"]] !== "J" || tauler[variable["y"]][variable["x"]] !== "F") {//comprovem si esta ocupat
                    noEstaOcupat = false;
                }

            } while ((esParet(variable["x"], variable["y"])) && noEstaOcupat === false);

            if (typeof variable["direccioUsuari"] === 'undefined') { //si direccioUsuari es undefined significa que es un fantasma
                //utilitzo un typeof perque em digui el tipus de la variable, si no esta definida, aquesta funcio retornara un undefined
                //referencia: (https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/typeof)

                tauler[variable["y"]][variable["x"]] = "F"; //F de fantasma
            } else {//si no, es el jugador...
                tauler[variable["y"]][variable["x"]] = "J"; //j de jugador
            }
        }

        function esParet(x, y) {
            //aquesta funcio ens diu si es paret o no la x i la y que li pasem per parametre
            if (tauler[y][x] === 0) { //primer comença a comprobar la y perque el tauler el tinc de manera que la posició 0,0 es la part inferior esquerra
                return true;
            } else {
                return false;
            }
        }

        function generarNumeroAleatori(min, max) { //genera un numero aleatori
            return Math.round(Math.random() * ((max) - min) + min);
        }

        function mostrarTauler() {
            //aquesta funcio ens mostra el tauler
            document.write("<table>"); //ho mostrem amb una taula
            document.write("<tr>");
            for (var mostrarX = -1; mostrarX < tauler.length; mostrarX++) {
                document.write("<td>");
                document.write("<span style='background-color: #93b9ff;'>" + mostrarX + "</span>"); //pintem x
                document.write("</td>");

            }
            document.write("</tr>");


            for (var i = 0; i < tauler.length; i++) {
                document.write("<tr>");

                document.write("<td>");
                document.write("<span style='background-color: #ff7644;'>" + i + "</span>"); //pintem y
                document.write("</td>");
                for (var j = 0; j < tauler.length; j++) {
                    document.write("<td>");
                    if (tauler[j][i] === 0) {
                        //diferenciem els limits
                        document.write("<span style='background-color: #474747;'>" + tauler[j][i] + "</span>");
                    } else if (tauler[j][i] === "J") {
                        document.write("<span style='background-color: red;'>" + tauler[j][i] + "</span>");
                    } else if (tauler[j][i] === "F") {
                        document.write("<span style='background-color: yellow;'>" + tauler[j][i] + "</span>");
                    }
                    document.write("</td>");
                }
                document.write("</tr>");
            }
            document.write("</table>");
        }

    </script>
</html>
